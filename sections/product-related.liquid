{%- assign meta = product.metafields.katefarms -%}

{%- if meta.related_products != blank -%}

<section data-section-type="related-products" data-section-id="{{ section.id }}">
  <div class="container mt-6 xl:mt-12">
    {%- if section.settings.heading != blank -%}
      <div class="row">

        <div class="col w-full">
          <h2 class="md:border-b md:border-lightest-gray text-black leading-tight md:pb-2 mb-2 text-4xl">{{ section.settings.heading }}</h2>
        </div>

      </div>
    {%- endif -%}

    {%- assign related_products = meta.related_products | split: '|' -%}

    <div class="row sm:justify-center md:justify-start">

      {%- comment %}<locksmith:0537>{% endcomment -%}
        {%- assign locksmith_558e_forloop__size = 0 %}{%- for handle in related_products -%}{% capture var %}{% render 'locksmith-variables', scope: 'subject', subject: handle, variable: 'transparent' %}{% endcapture %}{% if var == 'true' %}{% assign locksmith_558e_forloop__size = locksmith_558e_forloop__size | plus: 1 %}{% endif %}{% endfor %}{% assign locksmith_558e_forloop__index = nil -%}
      {%- comment %}</locksmith:0537>{% endcomment -%}
      {%- for handle in related_products -%}
        {%- comment %}<locksmith:3d05>{% endcomment -%}
          {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: handle, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% if locksmith_558e_forloop__index == nil %}{% assign locksmith_558e_forloop__index = 1 %}{% assign locksmith_558e_forloop__index0 = 0 %}{% else %}{% assign locksmith_558e_forloop__index = locksmith_558e_forloop__index | plus: 1 %}{% assign locksmith_558e_forloop__index0 = locksmith_558e_forloop__index0 | plus: 1 %}{% endif %}{% if locksmith_558e_forloop__index == 1 %}{% assign locksmith_558e_forloop__first = true %}{% else %}{% assign locksmith_558e_forloop__first = false %}{% endif %}{% if locksmith_558e_forloop__index == locksmith_558e_forloop__size %}{% assign locksmith_558e_forloop__last = true %}{% else %}{% assign locksmith_558e_forloop__last = false %}{% endif %}{% assign locksmith_558e_forloop__rindex = locksmith_558e_forloop__size | minus: locksmith_558e_forloop__index | minus: 1 %}{% assign locksmith_558e_forloop__rindex0 = locksmith_558e_forloop__size | minus: locksmith_558e_forloop__index0 | minus: 1 %}{% else %}{% continue %}{% endif -%}
        {%- comment %}</locksmith:3d05>{% endcomment -%}
        {%- assign _product = all_products[handle] -%}

        {%- unless product == empty -%}
          <div class="col py-3 w-full sm:w-1/2 md:flex md:w-1/3 md:py-2">
            {% include 'product-card' with _product: _product, url: _product.url, position: locksmith_558e_forloop__index, listType: 'related-products' %}
          </div>
        {%- endunless -%}
      {%- endfor -%}

    </div>
  </div>
</section>

{%- endif -%}

{% schema %}
  {
    "name": "Related Products",
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading"
      }
    ]
  }
{% endschema %}
